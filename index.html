<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Gestão - 3ª Promotoria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        // Passo 1: Crie um projeto no console.firebase.google.com
        // Passo 2: Vá em Configurações do Projeto -> Geral -> Seus aplicativos -> Web (</>)
        // Passo 3: Copie o conteúdo de 'const firebaseConfig = {...}' e cole dentro das aspas abaixo:
        
     window.__firebase_config = JSON.stringify({
            apiKey: "AIzaSyAzad4DmO5ZyKBgMSpjsivd6c0_VJ6LwvY",
            authDomain: "painel-promotoria.firebaseapp.com",
            projectId: "painel-promotoria",
            storageBucket: "painel-promotoria.firebasestorage.app",
            messagingSenderId: "357692683201",
            appId: "1:357692683201:web:09021bd141cc33e2aeb540",
            measurementId: "G-36RC8TJSRC"
        });

        // Nome do banco de dados/coleção (pode manter este)
        window.__app_id = 'promotoria-gestao-v1'; 
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .kanban-column { min-width: 350px; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-[#f8fafc]">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const { useState, useEffect, useMemo } = React;

        // Leitura da configuração que injetamos no head
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'promotoria-gestao-default';

        // Inicialização
        let db, auth;
        if (firebaseConfig.apiKey && firebaseConfig.apiKey !== "COLE_SUA_API_KEY_AQUI") {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            } catch (error) {
                console.error("Erro ao iniciar Firebase:", error);
            }
        }

        const AREAS = [
            { id: 'meio-ambiente', label: 'Meio Ambiente', icon: 'ShieldCheck' },
            { id: 'execucao-penal', label: 'Execução Penal', icon: 'Gavel' },
            { id: 'urbanismo', label: 'Urbanismo', icon: 'MapPin' },
            { id: 'delegacao', label: 'Delegação de Tarefas', icon: 'UserCheck' },
        ];

        const STATUS_OPTIONS = [
            'Cota de diligência', 'Manifestação', 'Encaminhado para fazer denúncia',
            'Denunciado', 'Encaminhado para fazer arquivamento', 'Arquivado',
            'Encaminhado para ANPP', 'Oferecido ANPP', 'Finalizado'
        ];

        const RENEWAL_DAYS = 90;

        // ... (Mantenha o resto da constante DADOS_MESTRA aqui) ...
        const DADOS_MESTRA = {
             "0010059-97.2025.8.16.0083": { date: "2026-01-09", obs: "juntada cota diligencia", status: "Cota de diligência" },
             // ... para encurtar a resposta, o resto dos dados fica aqui igual ao original
        };

        const Icon = ({ name, className }) => {
            useEffect(() => { if(window.lucide) lucide.createIcons(); }, [name]);
            return <i data-lucide={name.toLowerCase().replace(/([a-z])([A-Z])/g, '$1-$2')} className={className}></i>;
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [inqueritos, setInqueritos] = useState([]);
            const [activeArea, setActiveArea] = useState('meio-ambiente');
            const [searchTerm, setSearchTerm] = useState('');
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingInquerito, setEditingInquerito] = useState(null);
            const [loading, setLoading] = useState(true);
            const [notification, setNotification] = useState(null);

            useEffect(() => {
                if (!auth) { setLoading(false); return; }
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (e) { console.error("Falha na autenticação", e); }
                };
                initAuth();
                return onAuthStateChanged(auth, u => { setUser(u); setLoading(false); });
            }, []);

            useEffect(() => {
                if (!user || !db) return;
                const q = collection(db, 'artifacts', appId, 'public', 'data', 'inqueritos');
                return onSnapshot(q, (s) => setInqueritos(s.docs.map(d => ({ id: d.id, ...d.data() }))));
            }, [user]);

            const notify = (msg) => { setNotification(msg); setTimeout(() => setNotification(null), 3000); };

            const handleSave = async (e) => {
                e.preventDefault();
                const f = new FormData(e.target);
                const dManual = f.get('date');
                const date = dManual ? new Date(dManual + "T12:00:00Z").toISOString() : new Date().toISOString();
                
                const data = {
                    numero: f.get('numero'),
                    area: f.get('area'),
                    status: f.get('status'),
                    observacoes: f.get('obs'),
                    responsavel: f.get('responsavel'),
                    lastRenewal: date,
                    updatedAt: new Date().toISOString(),
                    updatedBy: user.uid
                };

                try {
                    if (editingInquerito) {
                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'inqueritos', editingInquerito.id), data);
                    } else {
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'inqueritos'), data);
                    }
                    setIsModalOpen(false); setEditingInquerito(null); notify("Registro guardado!");
                } catch (err) { notify("Erro ao salvar: " + err.message); }
            };

            const syncAll = async () => {
                if (!db) return notify("Erro conexão.");
                const batch = writeBatch(db);
                let added = 0;
                Object.entries(DADOS_MESTRA).forEach(([num, info]) => {
                    if (!inqueritos.some(i => i.numero === num)) {
                        const d = doc(collection(db, 'artifacts', appId, 'public', 'data', 'inqueritos'));
                        batch.set(d, {
                            numero: num, area: 'meio-ambiente', status: info.status, observacoes: info.obs,
                            responsavel: '',
                            lastRenewal: new Date(info.date + "T12:00:00Z").toISOString(), updatedAt: new Date().toISOString(), updatedBy: user.uid
                        });
                        added++;
                    }
                });
                if (added > 0) { await batch.commit(); notify(`${added} processos importados.`); }
                else notify("Tudo atualizado.");
            };

            const getDays = (date) => {
                const diff = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
                return Math.max(0, RENEWAL_DAYS - diff);
            };

            const filtered = inqueritos.filter(i => {
                const matchesSearch = (i.numero.includes(searchTerm) || (i.observacoes || "").toLowerCase().includes(searchTerm.toLowerCase()) || (i.responsavel || "").toLowerCase().includes(searchTerm.toLowerCase()));
                if (activeArea === 'delegacao') {
                    return i.responsavel && i.responsavel.trim() !== '' && matchesSearch;
                }
                return i.area === activeArea && matchesSearch;
            });

            if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "COLE_SUA_API_KEY_AQUI") return (
                <div className="h-screen flex flex-col items-center justify-center p-10 text-center bg-slate-100">
                    <Icon name="AlertTriangle" className="w-16 h-16 text-amber-500 mb-4" />
                    <h1 className="text-2xl font-black text-slate-800">Configuração Necessária</h1>
                    <p className="text-slate-500 mt-2 max-w-md">Abra o arquivo HTML em um editor de texto e cole suas chaves do Firebase na seção indicada no início do arquivo.</p>
                </div>
            );

            if (loading) return <div className="h-screen flex items-center justify-center font-black text-indigo-600 animate-pulse text-xl tracking-[0.3em]">CARREGANDO...</div>;

            // Retorna o JSX original (não alterei o layout)
            return (
                <div className="min-h-screen pb-32">
                    <header className="bg-white border-b px-8 h-20 flex items-center justify-between sticky top-0 z-30 shadow-sm">
                        <div className="flex items-center gap-4">
                            <div className="bg-indigo-600 p-2.5 rounded-2xl shadow-lg"><Icon name="ShieldCheck" className="text-white w-7 h-7" /></div>
                            <div>
                                <h1 className="text-xl font-black uppercase tracking-tighter text-slate-900 leading-none">Gestão Digital</h1>
                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">3ª Promotoria de Justiça</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-4 flex-1 max-w-5xl mx-12">
                            <div className="relative w-full group">
                                <Icon name="Search" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4 group-focus-within:text-indigo-500 transition-all" />
                                <input onChange={e => setSearchTerm(e.target.value)} placeholder="Pesquisar..." className="w-full pl-12 pr-6 py-3 bg-slate-100 border-none rounded-2xl outline-none focus:ring-4 focus:ring-indigo-50 focus:bg-white transition-all text-sm shadow-inner" />
                            </div>
                            <button onClick={syncAll} className="bg-emerald-50 text-emerald-700 font-bold px-6 py-3 rounded-2xl border border-emerald-100 hover:bg-emerald-600 hover:text-white transition-all text-xs shadow-sm">SINCRONIZAR PDF</button>
                            <button onClick={() => { setEditingInquerito(null); setIsModalOpen(true); }} className="bg-slate-900 text-white font-bold px-8 py-3 rounded-2xl hover:bg-indigo-600 transition-all shadow-xl text-xs active:scale-95">NOVO REGISTRO</button>
                        </div>
                    </header>

                    <nav className="bg-white border-b sticky top-20 z-20 flex px-8 gap-4 overflow-x-auto scrollbar-hide">
                        {AREAS.map(a => (
                            <button key={a.id} onClick={() => setActiveArea(a.id)} className={`py-6 px-10 border-b-4 transition-all flex items-center gap-3 whitespace-nowrap ${activeArea === a.id ? 'border-indigo-600 text-indigo-600 font-black' : 'border-transparent text-slate-400 font-bold hover:text-slate-600'}`}>
                                <Icon name={a.icon} className="w-5 h-5" /> {a.label.toUpperCase()}
                                <span className={`text-[10px] px-2.5 py-1 rounded-xl font-black ${activeArea === a.id ? 'bg-indigo-100' : 'bg-slate-100 text-slate-400'}`}>
                                    {activeArea === 'delegacao' && a.id === 'delegacao' ? inqueritos.filter(i => i.responsavel && i.responsavel.trim() !== '').length : inqueritos.filter(i => i.area === a.id).length}
                                </span>
                            </button>
                        ))}
                    </nav>

                    <main className="p-8 flex gap-8 overflow-x-auto min-h-[calc(100vh-160px)] scrollbar-hide">
                        {STATUS_OPTIONS.map(s => (
                            <div key={s} className="kanban-column flex flex-col gap-5">
                                <h3 className="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] px-4 flex justify-between items-center">
                                    <span className="flex items-center gap-2"><div className={`w-2.5 h-2.5 rounded-full ${filtered.filter(i => i.status === s).length > 0 ? 'bg-indigo-500 shadow-lg' : 'bg-slate-300'}`}></div> {s}</span>
                                    <span className="bg-white border border-slate-100 px-3 py-1 rounded-lg shadow-sm">{filtered.filter(i => i.status === s).length}</span>
                                </h3>
                                <div className="flex-1 bg-slate-100/40 rounded-[2.5rem] p-4 border-2 border-dashed border-slate-200/50 flex flex-col gap-5">
                                    {filtered.filter(i => i.status === s).map(inq => {
                                        const d = getDays(inq.lastRenewal);
                                        const urgency = d <= 10 ? 'red' : d <= 20 ? 'amber' : 'emerald';
                                        return (
                                            <div key={inq.id} onClick={() => { setEditingInquerito(inq); setIsModalOpen(true); }} className="bg-white rounded-[2rem] p-7 shadow-sm border border-slate-200 hover:shadow-2xl hover:border-indigo-400 transition-all cursor-pointer relative overflow-hidden group">
                                                <div className={`absolute top-0 left-0 w-full h-2 bg-${urgency}-500 ${d <= 10 ? 'animate-pulse' : ''}`}></div>
                                                <div className="flex justify-between items-start mb-5">
                                                    <span className="text-[12px] font-mono font-black text-slate-700 bg-slate-100 px-4 py-2 rounded-2xl border border-slate-200 shadow-inner">{inq.numero}</span>
                                                    <button onClick={(e) => { e.stopPropagation(); if(confirm('Excluir?')) deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'inqueritos', inq.id)); }} className="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all p-2 hover:bg-red-50 rounded-xl"><Icon name="Trash2" className="w-5 h-5" /></button>
                                                </div>
                                                {inq.responsavel && (
                                                    <div className="mb-4 flex items-center gap-2">
                                                        <span className="bg-indigo-50 text-indigo-700 border border-indigo-100 text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider flex items-center gap-1">
                                                            <Icon name="User" className="w-3 h-3" /> {inq.responsavel}
                                                        </span>
                                                    </div>
                                                )}
                                                <div className={`text-[11px] font-black uppercase tracking-widest px-4 py-2.5 rounded-2xl border mb-4 flex items-center gap-3 ${urgency === 'red' ? 'bg-red-50 text-red-600 border-red-100' : urgency === 'amber' ? 'bg-amber-50 text-amber-600 border-amber-100' : 'bg-emerald-50 text-emerald-600 border-emerald-100'}`}>
                                                    <Icon name={urgency === 'red' ? 'AlertTriangle' : urgency === 'amber' ? 'Clock' : 'CheckCircle'} className="w-4 h-4" /> {d} DIAS RESTANTES
                                                </div>
                                                {inq.observacoes && <p className="text-[12px] text-slate-500 italic line-clamp-4 mb-5 bg-slate-50/50 p-4 rounded-2xl border border-slate-100/50">"{inq.observacoes}"</p>}
                                                <div className="flex justify-between items-center pt-5 border-t border-slate-50">
                                                    <span className="text-[10px] font-bold text-slate-400 uppercase flex items-center gap-2 tracking-tighter"><Icon name="Calendar" className="w-4 h-4 opacity-40" /> {new Date(inq.lastRenewal).toLocaleDateString('pt-BR')}</span>
                                                    <button onClick={(e) => { e.stopPropagation(); updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'inqueritos', inq.id), { lastRenewal: new Date().toISOString(), updatedAt: new Date().toISOString() }); notify("Prazo renovado!"); }} className="text-[10px] font-black text-indigo-600 bg-indigo-50 px-4 py-2 rounded-xl hover:bg-indigo-600 hover:text-white transition-all uppercase shadow-sm">RENOVAR</button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ))}
                    </main>

                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/80 backdrop-blur-[6px] p-6" onClick={() => setIsModalOpen(false)}>
                            <div className="bg-white rounded-[4rem] w-full max-w-2xl overflow-hidden shadow-2xl animate-in zoom-in duration-300 border border-white/20" onClick={e => e.stopPropagation()}>
                                <div className="px-14 py-10 bg-slate-50 border-b flex justify-between items-center">
                                    <div><h2 className="text-2xl font-black uppercase text-slate-900">{editingInquerito ? 'Editar' : 'Novo'}</h2><p className="text-[12px] text-slate-400 font-bold uppercase tracking-[0.3em] mt-1">Sincronização Ativa</p></div>
                                    <button onClick={() => setIsModalOpen(false)} className="text-slate-300 hover:text-slate-900 transition-all p-3 hover:bg-slate-100 rounded-full"><Icon name="X" className="w-10 h-10" /></button>
                                </div>
                                <form onSubmit={handleSave} className="p-14 flex flex-col gap-8">
                                    <div className="space-y-2"><label className="text-[11px] font-black text-slate-400 uppercase tracking-[0.4em] ml-5">Nº Processo</label><input name="numero" required defaultValue={editingInquerito?.numero} className="w-full px-10 py-6 bg-slate-50 border-2 border-slate-100 rounded-[2.5rem] outline-none focus:border-indigo-500 font-mono text-xl shadow-inner" placeholder="0000000-00.2025.8.16.0083" /></div>
                                    <div className="space-y-2"><label className="text-[11px] font-black text-slate-400 uppercase tracking-[0.4em] ml-5">Data Movimentação</label><input type="date" name="date" required defaultValue={editingInquerito ? new Date(editingInquerito.lastRenewal).toISOString().split('T')[0] : new Date().toISOString().split('T')[0]} className="w-full px-10 py-6 bg-slate-50 border-2 border-slate-100 rounded-[2.5rem] outline-none focus:border-indigo-500 font-bold text-slate-700 shadow-inner" /></div>
                                    
                                    <div className="space-y-2">
                                        <label className="text-[11px] font-black text-indigo-600 uppercase tracking-[0.4em] ml-5 flex items-center gap-2"><Icon name="UserCheck" className="w-4 h-4" /> Delegar para Responsável</label>
                                        <input name="responsavel" defaultValue={editingInquerito?.responsavel} className="w-full px-10 py-6 bg-indigo-50/50 border-2 border-indigo-100 rounded-[2.5rem] outline-none focus:border-indigo-500 font-bold text-slate-700 shadow-inner placeholder-indigo-300" placeholder="Nome do responsável (opcional)" />
                                    </div>

                                    <div className="grid grid-cols-2 gap-8">
                                        <div className="space-y-2"><label className="text-[11px] font-black text-slate-400 uppercase tracking-[0.4em] ml-5">Área</label><select name="area" defaultValue={editingInquerito?.area || activeArea} className="w-full px-8 py-6 bg-slate-50 border-2 border-slate-100 rounded-[2.5rem] outline-none focus:border-indigo-500 font-bold text-slate-700 appearance-none shadow-sm cursor-pointer">{AREAS.filter(a => a.id !== 'delegacao').map(a => <option key={a.id} value={a.id}>{a.label}</option>)}</select></div>
                                        <div className="space-y-2"><label className="text-[11px] font-black text-slate-400 uppercase tracking-[0.4em] ml-5">Status</label><select name="status" defaultValue={editingInquerito?.status || STATUS_OPTIONS[0]} className="w-full px-8 py-6 bg-slate-50 border-2 border-slate-100 rounded-[2.5rem] outline-none focus:border-indigo-500 font-bold text-slate-700 appearance-none shadow-sm cursor-pointer">{STATUS_OPTIONS.map(s => <option key={s} value={s}>{s}</option>)}</select></div>
                                    </div>
                                    <div className="space-y-2"><label className="text-[11px] font-black text-slate-400 uppercase tracking-[0.4em] ml-5">Notas</label><textarea name="obs" rows="3" defaultValue={editingInquerito?.observacoes} className="w-full px-10 py-7 bg-slate-50 border-2 border-slate-100 rounded-[2.5rem] outline-none focus:border-indigo-500 resize-none text-sm font-medium shadow-inner" placeholder="Diligências..." /></div>
                                    <div className="flex gap-6 pt-4"><button type="button" onClick={() => setIsModalOpen(false)} className="flex-1 py-6 border-2 border-slate-100 rounded-[2.5rem] text-[13px] font-black text-slate-400 hover:bg-slate-50 uppercase tracking-[0.3em]">Cancelar</button><button type="submit" className="flex-2 bg-indigo-600 text-white py-6 rounded-[2.5rem] text-[13px] font-black uppercase tracking-[0.3em] shadow-xl hover:bg-indigo-700 active:scale-95">Salvar</button></div>
                                </form>
                            </div>
                        </div>
                    )}

                    {notification && <div className="fixed bottom-32 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-12 py-6 rounded-[3rem] shadow-2xl flex items-center gap-5 animate-in slide-in-from-bottom-16 z-50 border border-white/10"><Icon name="CheckCircle" className="text-emerald-500 w-6 h-6" /><span className="text-sm font-black uppercase tracking-[0.25em]">{notification}</span></div>}

                    <footer className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-2xl border-t px-14 py-6 flex justify-between items-center z-40 shadow-[0_-10px_30px_rgba(0,0,0,0.02)]">
                        <div className="flex gap-12 text-[12px] font-black text-slate-400 uppercase tracking-[0.25em]">
                            <div className="flex items-center gap-4"><div className="w-4 h-4 rounded-full bg-emerald-500 shadow-lg"></div> Regular</div>
                            <div className="flex items-center gap-4"><div className="w-4 h-4 rounded-full bg-amber-500 shadow-lg"></div> Prazo {'<'} 20d</div>
                            <div className="flex items-center gap-4"><div className="w-4 h-4 rounded-full bg-red-500 shadow-lg animate-pulse"></div> Urgente (10d)</div>
                        </div>
                        <div className="bg-indigo-600/5 px-10 py-3.5 rounded-full text-[11px] font-black text-indigo-500 uppercase tracking-[0.35em] border border-indigo-100 shadow-sm flex items-center gap-4"><div className="w-2.5 h-2.5 rounded-full bg-indigo-500 animate-ping"></div> NUVEM ATIVA</div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>

